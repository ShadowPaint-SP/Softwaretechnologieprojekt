<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org" xmlns:sec="http://www.thymeleaf.org/extras/spring-security"
    xmlns:layout="http://www.ultraq.net.nz/thymeleaf/layout" layout:decorate="~{layout.html(title=#{catalog.title})}">

<head></head>

<body>
    <main layout:fragment="input">
        <div>
            <form class="ui form" method="post" action="/plots#filter">
                <a id="filter"></a>

                <!-- Search Panel -->
                <table class="ui table">
                    <td>
                        <div class="inline fields">
                            <div class="one wide field">
                                <label>Zeitraum</label>
                            </div>
                            <div class="three wide field">
                                <input type="date" name="arrival" th:value="${searchQuery.defaultedArrival}"
                                    th:min="${searchQuery.minArrivalDate}" onchange="this.form.submit()">
                            </div>
                            <div class="three wide field">
                                <input type="date" name="departure" th:value="${searchQuery.defaultedDeparture}"
                                    th:min="${searchQuery.defaultedArrival}" onchange="this.form.submit()">
                            </div>
                            <div class="one wide field"></div>
                            <div class="one wide field">
                                <label>Parkplatz</label>
                            </div>
                            <div class="six wide field">
                                <div class="ui field">
                                    <select class="flex" name="parking" onchange="this.form.submit()">
                                        <option value="0" th:selected="${searchQuery.parking==0}"
                                            th:text="#{catalog.parking.no}"> </option>
                                        <option value="1" th:selected="${searchQuery.parking==1}"
                                            th:text="#{catalog.parking.bike}"></option>
                                        <option value="2" th:selected="${searchQuery.parking==2}"
                                            th:text="#{catalog.parking.car}"></option>
                                        <option value="3" th:selected="${searchQuery.parking==3}"
                                            th:text="#{catalog.parking.camper}"></option>
                                    </select>
                                    <label>mindestens</label>
                                </div>
                            </div>
                        </div>
                        <div class="inline fields">
                            <div class="one wide field">
                                <label>Größe</label>
                            </div>
                            <div class="three wide field">
                                <input type="number" name="sizeMin" th:value="${searchQuery.sizeMin}"
                                    th:placeholder="#{catalog.ranges.from}" onchange="this.form.submit()">
                            </div>
                            <div class="three wide field">
                                <input type="number" name="sizeMax" th:value="${searchQuery.sizeMax}"
                                    th:placeholder="#{catalog.ranges.to}" onchange="this.form.submit()">
                            </div>
                            <div class="one wide field"></div>
                            <div class="one wide field">
                                <label>Preis</label>
                            </div>
                            <div class="three wide field">
                                <input type="number" name="priceMin" th:value="${searchQuery.priceMin}"
                                    th:placeholder="#{catalog.ranges.from}" onchange="this.form.submit()">
                            </div>
                            <div class="three wide field">
                                <input type="number" name="priceMax" th:value="${searchQuery.priceMax}"
                                    th:placeholder="#{catalog.ranges.to}" onchange="this.form.submit()">
                            </div>
                        </div>
                    </td>
                </table>

                <!-- button to act as the default submit button, so the others don't. -->
                <button type="submit" class="hidden"></button>

                <!-- The table showing the available and unavailable Plots -->
                <div th:fragment="plot_table">
                    <!-- if preventing the fragment beging rendered, without beging explicitly included -->
                    <table class="ui item equal width table" th:if="${availablePlotsTable != null}">
                        <!-- The head of the table -->
                        <thead>
                            <tr>
                                <input type="hidden" name="firstWeekDate"
                                    th:value="${searchQuery.defaultedFirstWeekDate}">
                                <th class="bottom aligned">
                                    <h2 th:if="${availablePlotsTable}" th:text="#{catalog.plots.available}"></h2>
                                    <h2 th:if="${!availablePlotsTable}" th:text="#{catalog.plots.reserved}"></h2>
                                </th>
                                <th class="right aligned"><button type="submit" formaction="/plots/prev-week#filter">
                                        << /button>
                                </th>
                                <th class="center aligned" th:each="date, stat : ${weekDates}"
                                    th:utext=" #{'weekday.'+${stat.index}} + '<br/>' + ${date}">
                                <th class="left aligned"><button type="submit"
                                        formaction="/plots/next-week#filter">></button></th>
                            </tr>
                        </thead>
                        <!-- The body of the table -->
                        <tbody th:each="plot : ${allPlots.get(availablePlotsTable)}">
                            <tr>
                                <td class="ui items">
                                    <div class="ui item">
                                        <div class="ui small image" style="display: inline-block">
                                            <img src="/img/placeholder.png" />
                                        </div>
                                        <div class="content" style="display:inline-block; width:40px">
                                            <div class="header" th:text="${plot.name}">null</div>
                                            <div class="meta">
                                                <div th:text="'Kosten: '+${plot.priceString}"></div>
                                                <div th:text="'Größe: '+${plot.sizeString}"></div>
                                                <div th:text="#{${plot.parking.label}}"></div>
                                            </div>
                                            <button type="submit" class="ui button"
                                                th:formaction="'/cart/' + ${plot.id}"
                                                th:text="#{catalog.reserve}"></button>
                                        </div>
                                    </div>
                                </td>
                                <td></td>
                                <td class="center aligned" th:each="available : ${availabilityTable.get(plot)}">
                                    <div th:if="${available}">frei</div>
                                    <div th:if="${!available}">NICHT</div>
                                </td>
                                <td></td>
                            </tr>
                        </tbody>
                    </table>
                </div>
                <!-- The inclusion of the table fragment -->
                <div th:replace=" servings/plotcatalog :: plot_table (availablePlotsTable=true)"></div> <br>
                <div th:replace=" servings/plotcatalog :: plot_table (availablePlotsTable=false)"></div> <br>
            </form>
        </div>
    </main>
</body>

</html>